<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ODOT Traffic Cameras</title>
    <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="{{url_for('static', filename='favicon.ico')}}" type="image/x-icon" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  </head>
  <body>
    <main>
      {% set incident_null = false %}
      {% set event_null = false %}
      <h1>Oregon Traffic Conditions</h1>
      {% for city,cameras in urls.items() %}
      <section class="city">
      <h2>{{ city }}</h2>
        {% for incident_city,incident in incidents.items() %}
          {% if incident_city == city %}
            {% if incident %}
            <ul class="incidents">
              {% for i in incident %}
                <li class="incidents__incident">
                  <p class="incidents__headline">{{ i["headline"] }}</p>
                  {% if i["create-time"] -%}
                  <p class="incidents__created">Created: {{ format_time(i["create-time"]) }} US/Pacific</p>
                  {%- endif %}
                  {% if i["update-time"] -%}
                  <p class="incidents__update">Updated: {{ format_time(i["update-time"]) }} US/Pacific</p>
                  {%- endif %}
                  {% if i["impact-desc"] -%}
                  <p class="incidents__desc">{{ i["impact-desc"] }}</p>
                  {%- endif %}
                  {% if i["comments"] -%}
                  <p class="incidents__comments">{{ i["comments"] }}</p>
                  {%- endif %}
                  <p class="incidents__metadata"><span class="incidents__highway">{{i["location"]["route-id"] if i["location"]["route-id"] else "Unspecified highway"}}</span>, milepost <span class="incidents__mileposts">{{i["location"]["start-location"]["start-milepost"]}}{% if i["location"]["end-location"]["end-milepost"]%} to {{ i["location"]["end-location"]["end-milepost"] }}{% endif %}</span></p>
                </li>
              {% endfor %}
            </ul>
            {% else %}
              {% set incident_null = true %}
            {% endif %} 
          {% endif %}
        {% endfor %}
        {% set city_events = events.get(city, []) %}
        {% if city_events | length > 0 %}
          <ul class="incidents">
            {% for ent in city_events %}
              <li class="incidents__incident">
                <p class="incidents__headline">{{ ent["Headline"] }}</p>
                {% if 'Weather' in ent["Type"] -%}
                <p class="incidents__icon"><img src={{url_for('static', filename='cloud-64.png')}}></p>
                {% elif 'Hazard' in ent["Type"] -%}
                <p class="incidents__icon"><img src={{url_for('static', filename='warning-flasher-65.png')}}></p>
                {%- endif %}
                {% if ent["EventStart"] -%}
                <p class="incidents__create">Start Date: {{ format_time(ent["EventStart"]) }} US/Pacific</p>
                {%- endif %}
                {% if ent["EventEnd"] -%}
                <p class="incidents__update">End Date: {{ format_time(ent["EventEnd"]) }} US/Pacific</p>
                {%- endif %}
                {% if ent["Comments"] -%}
                <p class="incidents__desc">{{ remove_tags(ent["Comments"]) }}</p>
                {%- endif %}
                {% if ent["SourceAgency"] -%}
                <p class="incidents__agency">{{ ent["SourceAgency"] }}</p>
                {%- endif %}
                {% if ent["ContactName"] -%}
                <p class="incidents__contactname">{{ ent["ContactName"] }}</p>
                {%- endif %}
                {% if ent["ContactEmail"] -%}
                <p class="incidents__contactemail">{{ ent["ContactEmail"] }}</p>
                {%- endif %}
                {% if ent["ContactOrganization"] -%}
                <p class="incidents__organization">{{ ent["ContactOrganization"] }}</p>
                {%- endif %}
                {% if ent["ContactPhone"] -%}
                <p class="incidents__phone">{{ ent["ContactPhone"] }}</p>
                {%- endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          {% set event_null = true %}
        {% endif %}
        {% if event_null == true and incident_null == true %}
        <p class="incidents--empty">No incidents at this time.</p>
        {% endif %}
        <ul class="cameras">
        {% for camera in cameras %}
            <li class="cameras__item"><figure class="cameras__figure">
                <img class="cameras__image" src="{{camera["cctv-url"]}}" alt="" loading="lazy" width="328" height="295" />
                <figcaption class="cameras__caption">{{ camera["cctv-other"]}}</figcaption>
            </figure></li>
        {% endfor %}
        </ul>
      </section>
      {% endfor %}
      <footer>
      <p>ZigSphere</p>
      <p>Information provided by the Oregon Department of Transportation API</p>
      </footer>
    </main>
  </body>
</html>
